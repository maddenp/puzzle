(ns puzzle.core
  (:gen-class)
  (:require [clojure.string :as str])
  (:use loco.constraints)
  (:use loco.core))

(def model
  [

   ($in :00 1 6) ($in :01 1 6) ($in :02 1 6) ($in :03 1 6) ($in :04 1 6) ($in :05 1 6)
   ($in :10 1 6) ($in :11 1 6) ($in :12 1 6) ($in :13 1 6) ($in :14 1 6) ($in :15 1 6)
   ($in :20 1 6) ($in :21 1 6) ($in :22 1 6) ($in :23 1 6) ($in :24 1 6) ($in :25 1 6)
   ($in :30 1 6) ($in :31 1 6) ($in :32 1 6) ($in :33 1 6) ($in :34 1 6) ($in :35 1 6)
   ($in :40 1 6) ($in :41 1 6) ($in :42 1 6) ($in :43 1 6) ($in :44 1 6) ($in :45 1 6)
   ($in :50 1 6) ($in :51 1 6) ($in :52 1 6) ($in :53 1 6) ($in :54 1 6) ($in :55 1 6)

   ($distinct [:00 :01 :02 :03 :04 :05])
   ($distinct [:10 :11 :12 :13 :14 :15])
   ($distinct [:20 :21 :22 :23 :24 :25])
   ($distinct [:30 :31 :32 :33 :34 :35])
   ($distinct [:40 :41 :42 :43 :44 :45])
   ($distinct [:50 :51 :52 :53 :54 :55])

   ($distinct [:00 :10 :20 :30 :40 :50])
   ($distinct [:01 :11 :21 :31 :41 :51])
   ($distinct [:02 :12 :22 :32 :42 :52])
   ($distinct [:03 :13 :23 :33 :43 :53])
   ($distinct [:04 :14 :24 :34 :44 :54])
   ($distinct [:05 :15 :25 :35 :45 :55])

   ($= ($+ :00 :01) 7)
   ($= ($+ :12 :13 :23) 10)
   ($= ($+ :54 :55) 3)

   ($= ($* ($* :10 :11) :20) 60)
   ($= ($* ($* ($* ($* :24 :25) :34) :35) :45) 864)
   ($= ($* ($* ($* ($* :33 :42) :43) :44) :53) 1200)
   ($= ($* ($* :40 :41) :50) 18)

   ($or ($= ($- :05 :15) 3)
        ($= ($- :15 :05) 3))

   ($or ($= ($- :21 :22 :32) 0)
        ($= ($- :21 :32 :22) 0)
        ($= ($- :22 :21 :32) 0)
        ($= ($- :22 :32 :21) 0)
        ($= ($- :32 :21 :22) 0)
        ($= ($- :32 :22 :21) 0))

   ($or ($= ($- :51 :52) 1)
        ($= ($- :52 :51) 1))

   ($or ($= ($* 2 :03) :02)
        ($= ($* 2 :02) :03))

   ($or ($= ($* 6 :14) :04)
        ($= ($* 6 :04) :14))

   ($or ($= ($* 2 :31) :30)
        ($= ($* 2 :30) :31))

   ])

(defn -main
  [& args]
  (let [digits (range 0 6)
        rc-kws (fn [x] (map #(keyword (str x %)) digits))]
    (doseq [solution (solutions model)]
      (let [row #(str/join " " (map solution (rc-kws %)))
            grid (str/join "\n" (map row digits))]
        (println (str "\n" grid "\n"))))))
